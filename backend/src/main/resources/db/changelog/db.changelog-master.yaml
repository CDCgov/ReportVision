databaseChangeLog:
  - changeSet:
      id: initial-schema
      author: zedd@skylight.digital
      changes:
        - createTable:
            tableName: api_user
            columns:
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: organization_id
                  type: uuid
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: email
                  type: text
              - column:
                  name: name
                  type: text
              - column:
                  name: password
                  type: text
        - createTable:
            tableName: label
            columns:
              - column:
                  name: required
                  type: boolean
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: color
                  type: text
              - column:
                  name: human_readable_name
                  type: text
              - column:
                  name: label
                  type: text
              - column:
                  name: type
                  type: text
        - createTable:
            tableName: organization
            columns:
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: name
                  type: text
        - createTable:
            tableName: feature_flag
            columns:
              - column:
                  name: enabled
                  type: boolean
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: organization_id
                  type: uuid
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: name
                  type: text
        - createTable:
            tableName: notification
            columns:
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: organization_id
                  type: uuid
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: content
                  type: text
        - createTable:
            tableName: organization_admins
            columns:
              - column:
                  name: api_user_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: organization_id
                  type: uuid
                  constraints:
                    nullable: false
        - createTable:
            tableName: template
            columns:
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: organization_id
                  type: uuid
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: description
                  type: text
              - column:
                  name: lab_name
                  type: text
              - column:
                  name: name
                  type: text
              - column:
                  name: status
                  type: text
                  constraints:
                    checkConstraint: "(status)::text = ANY (ARRAY['COMPLETED'::character varying, 'IN_PROGRESS'::character varying, 'DEPRECATED'::character varying])"
        - createTable:
            tableName: page
            columns:
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: template_id
                  type: uuid
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: shapes
                  type: text
              - column:
                  name: source_image
                  type: text
              - column:
                  name: template_image
                  type: text
        - createTable:
            tableName: extracted_field
            columns:
              - column:
                  name: confidence
                  type: double precision
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: extraction_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: label
                  type: text
              - column:
                  name: value
                  type: text
        - createTable:
            tableName: extraction
            columns:
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: segmentation_template_id
                  type: uuid
              - column:
                  name: updated_by_id
                  type: uuid
              - column:
                  name: upload_id
                  type: uuid
              - column:
                  name: status
                  type: text
                  constraints:
                    checkConstraint: "(status)::text = ANY (ARRAY['IN_PROGRESS'::character varying, 'IN_REVIEW'::character varying, 'SUBMISSION'::character varying, 'DISCARDED'::character varying])"
        - createTable:
            tableName: upload
            columns:
              - column:
                  name: created_at
                  type: timestamp(6)
              - column:
                  name: updated_at
                  type: timestamp(6)
              - column:
                  name: created_by_id
                  type: uuid
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: updated_by_id
                  type: uuid
        - createTable:
            tableName: extraction_source_images
            columns:
              - column:
                  name: extraction_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: source_images
                  type: text
        - createTable:
            tableName: page_labels
            columns:
              - column:
                  name: label_id
                  type: uuid
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: page_id
                  type: uuid
                  constraints:
                    nullable: false
  - changeSet:
      id: initial-constraints
      author: zedd@skylight.digital
      changes:
        - addForeignKeyConstraint:
            baseTableName: api_user
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_api_user_created_by_id
        - addForeignKeyConstraint:
            baseTableName: api_user
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_api_user_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: api_user
            baseColumnNames: organization_id
            referencedTableName: organization
            referencedColumnNames: id
            constraintName: fk_api_user_organization_id
        - addForeignKeyConstraint:
            baseTableName: label
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_label_created_by_id
        - addForeignKeyConstraint:
            baseTableName: label
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_label_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: organization
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_organization_created_by_id
        - addForeignKeyConstraint:
            baseTableName: organization
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_organization_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: feature_flag
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_feature_flag_created_by_id
        - addForeignKeyConstraint:
            baseTableName: feature_flag
            baseColumnNames: organization_id
            referencedTableName: organization
            referencedColumnNames: id
            constraintName: fk_feature_flag_organization_id
        - addForeignKeyConstraint:
            baseTableName: feature_flag
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_feature_flag_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: notification
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_notification_created_by_id
        - addForeignKeyConstraint:
            baseTableName: notification
            baseColumnNames: organization_id
            referencedTableName: organization
            referencedColumnNames: id
            constraintName: fk_notification_organization_id
        - addForeignKeyConstraint:
            baseTableName: notification
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_notification_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: organization_admins
            baseColumnNames: api_user_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_organization_admins_api_user_id
        - addForeignKeyConstraint:
            baseTableName: organization_admins
            baseColumnNames: organization_id
            referencedTableName: organization
            referencedColumnNames: id
            constraintName: fk_organization_admins_organization_id
        - addForeignKeyConstraint:
            baseTableName: template
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_template_created_by_id
        - addForeignKeyConstraint:
            baseTableName: template
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_template_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: template
            baseColumnNames: organization_id
            referencedTableName: organization
            referencedColumnNames: id
            constraintName: fk_template_organization_id
        - addForeignKeyConstraint:
            baseTableName: page
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_page_created_by_id
        - addForeignKeyConstraint:
            baseTableName: page
            baseColumnNames: template_id
            referencedTableName: template
            referencedColumnNames: id
            constraintName: fk_page_template_id
        - addForeignKeyConstraint:
            baseTableName: page
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_page_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: extracted_field
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_extracted_field_created_by_id
        - addForeignKeyConstraint:
            baseTableName: extracted_field
            baseColumnNames: extraction_id
            referencedTableName: extraction
            referencedColumnNames: id
            constraintName: fk_extracted_field_extraction_id
        - addForeignKeyConstraint:
            baseTableName: extracted_field
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_extracted_field_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: extraction
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_extraction_created_by_id
        - addForeignKeyConstraint:
            baseTableName: extraction
            baseColumnNames: segmentation_template_id
            referencedTableName: template
            referencedColumnNames: id
            constraintName: fk_extraction_segmentation_template_id
        - addForeignKeyConstraint:
            baseTableName: extraction
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_extraction_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: extraction
            baseColumnNames: upload_id
            referencedTableName: upload
            referencedColumnNames: id
            constraintName: fk_extraction_upload_id
        - addForeignKeyConstraint:
            baseTableName: upload
            baseColumnNames: created_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_upload_created_by_id
        - addForeignKeyConstraint:
            baseTableName: upload
            baseColumnNames: updated_by_id
            referencedTableName: api_user
            referencedColumnNames: id
            constraintName: fk_upload_updated_by_id
        - addForeignKeyConstraint:
            baseTableName: extraction_source_images
            baseColumnNames: extraction_id
            referencedTableName: extraction
            referencedColumnNames: id
            constraintName: fk_extraction_source_images_extraction_id
        - addForeignKeyConstraint:
            baseTableName: page_labels
            baseColumnNames: label_id
            referencedTableName: label
            referencedColumnNames: id
            constraintName: fk_page_labels_label_id
        - addForeignKeyConstraint:
            baseTableName: page_labels
            baseColumnNames: page_id
            referencedTableName: page
            referencedColumnNames: id
            constraintName: fk_page_labels_page_id